image: docker.io/eclipse-temurin:11

cache:
  paths:
    - .gradle
    - .gradle_home

variables:
  GRADLE_USER_HOME: ".gradle_home"
  GRADLE_OPTS: "-Dorg.gradle.logging.level=info -Dorg.gradle.logging.stacktrace=full -Dorg.gradle.parallel=true -Dorg.gradle.caching=true -Dorg.gradle.jvmargs=-Xmx8096M"

Build:
  stage: build
  artifacts:
    expire_in: 30 days
    paths:
      - build
  before_script:
    - mkdir -p .gradle_home
  script:
    - ./gradlew clean assemble

.test:
  script:
    - ./bin/run-ci-tests.sh

Eclipse Temurin OpenJDK:
  stage: test
  needs: [ "Build" ]
  dependencies: ["Build"]
  image: docker.io/eclipse-temurin:11
  before_script:
    - mkdir -p .gradle_home
  script:
    - ./gradlew test

Mac OS:
  stage: test
  tags: ["saas-macos-medium-m1"]
  needs: [ "Build" ]
  dependencies: ["Build"]
  image: macos-13-xcode-14
  before_script:
    - mkdir -p .gradle_home
  script:
    - ./gradlew test

#CentOS 6 OpenJDK 11:
#  stage: test Java 11
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-centos6-x64:openjdk11
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#CentOS 6 OpenJDK 13:
#  stage: test Java 13
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-centos6-x64:openjdk13
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#CentOS 7 OpenJDK 8:
#  stage: test Java 8
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-centos7:openjdk8
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#CentOS 7 OpenJDK 11:
#  stage: test Java 11
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-centos7:openjdk11
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#CentOS 7 OpenJDK 13:
#  stage: test Java 13
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-centos7:openjdk13
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Ubuntu 16.04 AdopOpenJDK 8:
#  stage: test Java 8
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-ubuntu16.04:openjdk8
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Ubuntu 16.04 AdopOpenJDK 11:
#  stage: test Java 11
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-ubuntu16.04:openjdk11
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Ubuntu 16.04 AdopOpenJDK 13:
#  stage: test Java 13
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-ubuntu16.04:openjdk13
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Ubuntu 18.04 AdopOpenJDK 8:
#  stage: test Java 8
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-ubuntu18.04:openjdk8
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Ubuntu 18.04 AdopOpenJDK 11:
#  stage: test Java 11
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-ubuntu18.04:openjdk11
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Ubuntu 18.04 AdopOpenJDK 13:
#  stage: test Java 13
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-ubuntu18.04:openjdk13
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Debian Stretch AdopOpenJDK 8:
#  stage: test Java 8
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-debian-stretch:openjdk8
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Debian Stretch AdopOpenJDK 11:
#  stage: test Java 11
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-debian-stretch:openjdk11
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Debian Stretch AdopOpenJDK 13:
#  stage: test Java 13
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-debian-stretch:openjdk13
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Debian Buster AdopOpenJDK 8:
#  stage: test Java 8
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-debian-buster:openjdk8
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Debian Buster AdopOpenJDK 11:
#  stage: test Java 11
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-debian-buster:openjdk11
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
#
#Debian Buster AdopOpenJDK 13:
#  stage: test Java 13
#  needs: ["Build"]
#  image: registry.gitlab.com/jsass/docker/test-debian-buster:openjdk13
#  dependencies: ["Build"]
#  script:
#    - ./bin/run-ci-tests.sh
